<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#FFE5EC" />
  <title>é™½ã‚­ãƒ£ãƒ»é™°ã‚­ãƒ£è¨ºæ–­ï½œKawaii Meter</title>
  <style>
    :root{
      --bg:#FFF7FA; --card:#FFFFFF; --ink:#333; --muted:#666;
      --accent:#FF8AB3; --accent-2:#A0D8F1; --accent-3:#C5EBAA; --accent-4:#FCDDEC;
      --shadow:0 6px 24px rgba(0,0,0,.06), 0 2px 8px rgba(0,0,0,.06);
      --radius:18px; --radius-lg:28px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", "Yu Gothic", "Segoe UI", sans-serif;
      background:
        radial-gradient(1200px 600px at 0% -10%, #FFF0F6 10%, transparent 60%),
        radial-gradient(900px 500px at 100% 0%, #F3FAFF 10%, transparent 60%),
        var(--bg);
      color:var(--ink); -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      line-height:1.65;
    }
    .wrap{max-width:880px;margin:0 auto;padding:18px 16px 28px}
    header{display:flex;align-items:center;gap:10px;padding:10px 6px 14px;}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px;letter-spacing:.02em;}
    .brand-badge{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#FFDDEB);
      display:grid;place-items:center;box-shadow:var(--shadow)}
    .brand-badge span{font-size:22px}
    .sub{color:var(--muted);font-size:13px;margin-top:-4px}
    .card{background:var(--card);border-radius:var(--radius-lg);box-shadow:var(--shadow);padding:18px;}
    .screen{display:none}.screen.active{display:block}

    .hero{display:grid;gap:10px;justify-items:center;text-align:center;padding:6px 8px 14px;}
    .hero h1{margin:8px 0 0;font-size:24px}
    .hero p{margin:4px 0;color:var(--muted)}
    .start-art{width:200px;height:200px;border-radius:50%;
      background:conic-gradient(from 0deg,#FFD3E1, #E8F8FF, #E9FFD8, #FFD3E1);
      filter:saturate(1.1);display:grid;place-items:center;position:relative;overflow:hidden;box-shadow:var(--shadow)}
    .float{position:absolute;animation:float 6s ease-in-out infinite;opacity:.9}
    .float.s1{top:8%;left:10%;animation-delay:.2s}
    .float.s2{bottom:8%;right:6%;animation-delay:1.2s}
    .float.s3{top:14%;right:22%;animation-delay:2.2s}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(8px)}}
    .btn{appearance:none;border:0;border-radius:16px;padding:14px 18px;
      font-weight:700;letter-spacing:.03em;cursor:pointer;transition:.2s transform,.2s box-shadow;
      background:linear-gradient(180deg,var(--accent),#FFA6C8);color:#fff;box-shadow:var(--shadow);font-size:16px}
    .btn:active{transform:translateY(1px)}
    .btn.ghost{background:#fff;color:var(--ink);border:2px solid #eee}

    /* Quiz */
    .progress{height:12px;background:#F6F7FB;border-radius:999px;overflow:hidden;position:relative;margin:6px 2px 18px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#FFC2D9,#B7E6FF,#D8FFB2);transition:width .4s ease;border-radius:999px}
    .progress .hearts{position:absolute;inset:0;display:flex;gap:2px;justify-content:space-between;padding:0 4px;opacity:.75}
    .progress .hearts span{font-size:11px;line-height:12px}
    .qhead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:4px 0 10px}
    .qnum{font-weight:800;background:#FFF0F6;color:#C2185B;border-radius:999px;padding:4px 10px}
    .qtxt{font-size:18px;font-weight:700}
    .options{display:grid;grid-template-columns:1fr;gap:10px;margin:12px 0}
    @media(min-width:560px){.options{grid-template-columns:repeat(5,1fr)}}
    .opt{border:2px solid #F0F0F0;border-radius:14px;padding:14px 10px;text-align:center;cursor:pointer;user-select:none;
      display:grid;gap:6px;align-content:center;min-height:72px;background:#fff;transition:border-color .12s, box-shadow .12s, transform .08s}
    .opt:active{transform:scale(.98)}
    .opt .emo{font-size:22px}
    .opt .lbl{font-size:13px;color:#444}
    input[type=radio]{position:absolute;opacity:0;pointer-events:none}
    .selected{border-color:var(--accent);box-shadow:0 0 0 4px #FFE5EF}

    /* Result */
    .result-top{display:grid;gap:14px;justify-items:center;text-align:center}
    .meter{width:180px;height:180px;border-radius:50%;
      background:conic-gradient(#FF85B3 calc(var(--pct)*1%), #F3F3F3 0);
      position:relative;display:grid;place-items:center;box-shadow:var(--shadow)}
    .meter:after{content:"";position:absolute;inset:12px;border-radius:50%;background:#fff;box-shadow:inset 0 0 0 6px #FFF3F8;}
    .meter .val{position:relative;font-weight:800;font-size:28px;z-index:1}
    .title{font-weight:800;font-size:18px;background:#FFF0F6;padding:6px 10px;border-radius:12px;display:inline-block}
    .two-cols{display:grid;gap:16px;margin-top:12px}
    @media(min-width:720px){.two-cols{grid-template-columns: 1.1fr .9fr;align-items:start}}
    .speech{background:linear-gradient(#FFFFFF,#FFF7FB);border:2px dashed #FFE0EF;border-radius:18px;padding:14px 14px 18px}
    .char-card{background:#fff;border-radius:18px;padding:14px;box-shadow:var(--shadow);display:grid;gap:8px;justify-items:center}
    .share{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .muted{color:var(--muted);font-size:12px}

    .answers{margin-top:14px;font-size:14px;color:#444}
    .answers details{background:#FAFBFE;border-radius:12px;padding:10px;border:1px solid #EEF1F7}
    .answers summary{cursor:pointer;font-weight:700}
    .answers ol{margin:8px 0 0 18px}
    .answers li{margin:4px 0}

    @media(prefers-reduced-motion: reduce){
      .float{animation:none}
      .btn{transition:none}
      .bar{transition:none}
    }
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
    a{color:#1D6AE5;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand-badge" aria-hidden="true"><span>ğŸŒˆ</span></div>
      <div>
        <div class="brand">Kawaii Meterï½œé™½ã‚­ãƒ£ãƒ»é™°ã‚­ãƒ£è¨ºæ–­</div>
        <div class="sub">éŠã³ã§æ¥½ã—ã‚€ãƒ©ã‚¤ãƒˆè¨ºæ–­ï¼ˆå…¨12å•ãƒ»æ‰€è¦1åˆ†ï¼‰</div>
      </div>
    </header>

    <!-- START -->
    <section id="screen-start" class="screen active">
      <div class="card hero">
        <div class="start-art" aria-hidden="true">
          <div class="float s1">ğŸŒŸ</div>
          <div class="float s2">ğŸ“</div>
          <div class="float s3">ğŸ’«</div>
          <!-- ãƒã‚¹ã‚³ãƒƒãƒˆ -->
          <svg width="120" height="120" viewBox="0 0 120 120" role="img" aria-label="ã‹ã‚ã„ã„ãƒã‚¹ã‚³ãƒƒãƒˆ">
            <defs><radialGradient id="g0" cx="50%" cy="45%" r="60%">
              <stop offset="0%" stop-color="#FFF" /><stop offset="100%" stop-color="#FFD6E6" />
            </radialGradient></defs>
            <circle cx="60" cy="62" r="44" fill="url(#g0)" stroke="#FFB6CF" stroke-width="2"/>
            <circle cx="43" cy="58" r="5" fill="#333"/><circle cx="77" cy="58" r="5" fill="#333"/>
            <path d="M45 76 Q60 86 75 76" fill="none" stroke="#333" stroke-width="3" stroke-linecap="round"/>
            <circle cx="34" cy="66" r="6" fill="#FFC3D7" /><circle cx="86" cy="66" r="6" fill="#FFC3D7" />
            <polygon points="60,21 65,32 77,33 67,40 70,52 60,45 50,52 53,40 43,33 55,32" fill="#FFEE99" />
          </svg>
        </div>
        <h1>ã‚ãªãŸã®ã€Œé™½ã‚­ãƒ£ãƒ»é™°ã‚­ãƒ£åº¦ã€ã‚’<br/>ãµã‚“ã‚ã‚Šè¨ºæ–­</h1>
        <p>â€» ã‚ãã¾ã§ã‚¨ãƒ³ã‚¿ãƒ¡ç”¨ã€‚çµæœã§äººã‚’æ±ºã‚ã¤ã‘ãªã„ã‚„ã•ã—ã•ã‚’ã€‚</p>
        <div class="actions">
          <button class="btn" id="btnStart">ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹</button>
          <button class="btn ghost" id="btnAbout">è¨ºæ–­ã«ã¤ã„ã¦</button>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="screen-quiz" class="screen">
      <div class="card">
        <div class="progress" aria-hidden="true">
          <div class="bar" id="bar" style="width:0%"></div>
          <div class="hearts" id="hearts" aria-hidden="true"></div>
        </div>
        <div class="qhead">
          <div class="qnum" id="qnum">Q1/12</div>
          <div class="muted" id="assist" aria-live="polite"></div>
        </div>
        <div class="qtxt" id="qtxt">è³ªå•ãƒ†ã‚­ã‚¹ãƒˆ</div>
        <form id="form" class="options" aria-describedby="assist"><!-- options injected --></form>
        <!-- â€» ã€Œã¤ãã¸ï¼ã‚‚ã©ã‚‹ã€ãƒœã‚¿ãƒ³ã¯å‰Šé™¤ã€‚ã‚¿ãƒƒãƒ—ã§å³é·ç§» -->
      </div>
    </section>

    <!-- RESULT -->
    <section id="screen-result" class="screen">
      <div class="card">
        <div class="result-top">
          <div class="meter" id="meter" style="--pct:50"><div class="val" id="levelVal">Lv.5</div></div>
          <div>
            <div class="title" id="title20">ã‚¿ã‚¤ãƒˆãƒ«</div>
            <div class="muted" id="subline">é™½ã‚­ãƒ£åº¦ <b id="yang">5</b>ï¼10ãƒ»é™°ã‚­ãƒ£åº¦ <b id="yin">6</b>ï¼10</div>
          </div>
        </div>

        <div class="two-cols">
          <div class="speech" id="comment"><!-- ã‚³ãƒ¡ãƒ³ãƒˆ --></div>
          <div class="char-card">
            <div id="character" aria-label="ã‚ãªãŸã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼"></div>
            <div class="share">
              <button class="btn" id="btnShare">çµæœã‚’ã‚·ã‚§ã‚¢</button>
              <button class="btn ghost" id="btnCopy">ãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼</button>
              <button class="btn" id="btnRetry">ã‚‚ã†ä¸€å›ã‚„ã‚‹</button>
            </div>
          </div>
        </div>

        <div class="answers">
          <details>
            <summary>ã‚ãªãŸã®å›ç­”ï¼ˆã‚¿ãƒƒãƒ—ã§é–‹ãï¼‰</summary>
            <ol id="answerList"></ol>
          </details>
        </div>
      </div>
    </section>

    <footer><p>Â© 2025 Kawaii Meter â€“ ã“ã®è¨ºæ–­ã¯éŠã³ç›®çš„ã§ã™ã€‚å€‹äººæƒ…å ±ã¯åé›†ã—ã¾ã›ã‚“ã€‚</p></footer>
  </div>


<script>
"use strict";

/* --- ã‚¹ã‚³ã‚¢èª¿æ•´ãƒ€ã‚¤ãƒ¤ãƒ«ï¼ˆæ¥µç«¯å¯„ã‚Šãƒ—ãƒªã‚»ãƒƒãƒˆï¼‰ --- */
const SCORING = {
  GAMMA: 0.80,  // 0.60ã€œ1.00ï¼šå°ã•ã„ã»ã©ä¸¡ç«¯ãŒå‡ºã‚„ã™ã„ï¼ˆ0.8æ¨å¥¨ï¼‰
  EXTREME_BONUS: 0.50, // 0ã€œ1.0ï¼šæœ€ç«¯ã®å›ç­”ï¼ˆ0/4ï¼‰ã«åŠ ç‚¹
  // ãƒ¬ãƒ™ãƒ«å¢ƒç•Œï¼ˆ-1ã€œ1ã®ã‚¹ã‚³ã‚¢ã‚’10æ®µéšã«åˆ†å‰²ï¼‰ã€‚ä¸­å¤®ã‚’ç´°ãã€ç«¯ã‚’åºƒãã€‚
  CUTS: [-1, -0.28, -0.22, -0.17, -0.12, -0.07, 0.07, 0.12, 0.17, 0.22, 1]
  //            Lv1   Lv2    Lv3    Lv4    Lv5    Lv6    Lv7    Lv8    Lv9   Lv10
};

/* ---------- ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆ12å•ãƒ»è‡ªå‹•é€²è¡Œï¼‰ ---------- */
const QUESTIONS = [
  { text:"äººãŒé›†ã¾ã‚‹å ´æ‰€ã«è‡ªç„¶ã¨ã„ã‚‹", reverse:false },
  { text:"åˆå¯¾é¢ã¨è©±ã™ã®ã¯ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹", reverse:false },
  { text:"SNSã§è‡ªåˆ†ã®è¿‘æ³ã‚’ã‚ˆãç™ºä¿¡ã™ã‚‹", reverse:false },
  { text:"ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã¯å…¨åŠ›ã§æ¥½ã—ã‚€", reverse:false },
  { text:"ã¿ã‚“ãªã®å‰ã§ç™ºè¨€ã™ã‚‹ã®ã¯ãã‚“ãªã«è‹¦ã˜ã‚ƒãªã„", reverse:false },
  { text:"ã²ã¨ã‚Šæ™‚é–“ãŒã„ã¡ã°ã‚“è½ã¡ç€ã", reverse:true  },
  { text:"éŸ³ãŒå¤§ãã„å ´æ‰€ã¯å°‘ã—ã¤ã‹ã‚Œã‚„ã™ã„", reverse:true  },
  { text:"äºˆå®šãŒãªã„ã¨ã¡ã‚‡ã£ã¨ãã‚ãã‚ã™ã‚‹", reverse:false },
  { text:"å‹ã ã¡ã®å‹ã ã¡ã¨ã‚‚ã™ãä»²ã‚ˆããªã‚‹", reverse:false },
  { text:"ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸­å¿ƒã‚ˆã‚Šè£æ–¹ãŒè½ã¡ç€ã", reverse:true  },
  { text:"åˆã‚ã¦ã®å ´ã§ã‚‚è‡ªåˆ†ã‹ã‚‰ã‚ã„ã•ã¤ã§ãã‚‹", reverse:false },
  { text:"é•·ã„ã²ã¨ã‚Šæ™‚é–“ã§ã‚‚æ¡ˆå¤–ãŸã„ãã¤ã—ãªã„", reverse:true  },
];

/* ã‚¿ã‚¤ãƒˆãƒ«ï¼š10æ–‡å­—ç¨‹åº¦ã€ã‹ãª/ã‚«ãƒŠ/æ¼¢å­—ã‚’ãƒãƒ©ãƒ³ã‚¹ */
const TITLES = [
  "ã—ãšã‹ã‚å†…çœã‚¬ã‚¤ãƒ‰",     // Lv1
  "ã²ãã‚„ã‹å‚è¬€ãƒ¢ãƒ¼ãƒ‰",     // Lv2
  "ãŠã¡ã¤ããƒŸãƒ‰ãƒ«ã‚¿ã‚¤ãƒ—",   // Lv3
  "é™ã¨å‹•ã®ãƒãƒ©ãƒ³ã‚µãƒ¼",     // Lv4
  "ã¡ã‚‡ã†ã©ã„ã„ç¤¾äº¤æ´¾",     // Lv5
  "ã«ã“ã‚„ã‹ãƒˆãƒ¼ã‚¯æ´¾",       // Lv6
  "ãƒ ãƒ¼ãƒ‰ã¥ãã‚Šåäººç´š",     // Lv7
  "ãƒ•ã‚§ã‚¹æ°—è³ªã®ç››ä¸Šã’æ‰‹",   // Lv8
  "ç¬‘é¡”ç™ºé›»ãƒˆãƒƒãƒ—å±¤",       // Lv9
  "ç¥ç¥­ã‚»ãƒ³ã‚¿ãƒ¼ãƒªãƒ¼ãƒ€ãƒ¼",   // Lv10
];

/* ã‚³ãƒ¡ãƒ³ãƒˆï¼šæ¼¢å­—ç‡ã²ã‹ãˆã‚ãƒ»ã‚„ã‚ã‚‰ã‹å£èª¿ï¼ˆç´„200å­—ï¼‰ */
const COMMENTS = {
  1: "ã—ãšã‹ã«ã‚ˆã†ã™ã‚’è¦‹ã‚‹ã‚¿ã‚¤ãƒ—ã€‚ã«ãã‚„ã‹ãªå ´æ‰€ã‚ˆã‚Šã€ã²ã¨ã‚Šæ™‚é–“ã§ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ãŸã‚ã‚‹ã»ã†ãŒåˆã„ã¾ã™ã€‚å°‘äººæ•°ã ã¨ã“ã¨ã°ãŒã‚„ã•ã—ãå±Šãã®ã§ã€ç„¡ç†ã«ä¸»å½¹ã«ãªã‚‰ãªãã¦å¤§ä¸ˆå¤«ã€‚æ°—ãŒåˆã†äººã«ã ã‘ã€æ‰‰ã‚’ã¡ã‚‡ã£ã¨ã²ã‚‰ãã€‚ã¦ã„ã­ã„ãªè¦³å¯Ÿã¨ã¾ã˜ã‚ã•ã¯ã€ãƒãƒ¼ãƒ ã®å®‰å¿ƒã‚’ã¤ãã‚‹åŠ›ã§ã™ã€‚é™ã‘ã•ã¯ã‚ãªãŸã®ã¤ã‚ˆã¿ã€‚",
  2: "æ§ãˆã‚ãªã‚³ãƒŸãƒ¥åŠ›ã§å ´ã‚’ã•ã•ãˆã‚‹å‚è¬€ã‚¿ã‚¤ãƒ—ã€‚ç›®ç«‹ã¤ã‚ˆã‚Šã€æº–å‚™ã‚„èãå½¹ãŒã†ã¾ã„äººã€‚å°ã•ãªè¼ªã‹ã‚‰ã‚†ã£ãã‚Šåºƒã’ã‚Œã°ã€ã‚€ã‚Šãªãå‹ã ã¡ãŒãµãˆã¾ã™ã€‚é€±ã«ä¸€å›ã ã‘ã€ã‚ã„ã•ã¤ã‚„ä¸€è¨€ã®ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã‚’æ±ºã‚ã‚‹ã¨è‡ªä¿¡ãŒè‚²ã¡ã¾ã™ã€‚å°å£°ã§ã‚‚ã¡ã‚ƒã‚“ã¨å±Šãã€‚ã‚ãªãŸã®è¨€è‘‰ã¯ç©ºæ°—ã‚’ã‚„ã‚ã‚‰ã‹ãã—ã¾ã™ã€‚",
  3: "è½ã¡ç€ã„ãŸãƒŸãƒ‰ãƒ«ã€‚ã‚ˆãè¦‹ã¦ã€è€ƒãˆã¦ã‹ã‚‰è©±ã™ã‹ã‚‰ã€ã“ã¨ã°ãŒã‚„ã•ã—ãæ­£ç¢ºã€‚ã¾ã¨ã‚å½¹ã‚„ä»•ä¸Šã’ã§å…‰ã‚Šã¾ã™ã€‚ã¤ã‹ã‚ŒãŸæ—¥ã¯ã‚„ã™ã¿ã€å…ƒæ°—ãªæ—¥ã¯å°ã•ãªæŒ‘æˆ¦ã€‚ã‚†ã‚‹ã„ãƒªã‚ºãƒ ãŒé­…åŠ›ã‚’é«˜ã‚ã¾ã™ã€‚ç›¸æ‰‹ã®ã‚ˆã•ã‚’å¼•ãå‡ºã™è³ªå•ãŒå¾—æ„ã€‚ã¨ãã©ãæœ€åˆã®ã²ã¨å£°ã‚’ã€‚ã‚ãªãŸã®ä¸€æ­©ãŒå ´ã‚’ã‚ãŸãŸã‚ã¾ã™ã€‚",
  4: "é™ã¨å‹•ã®ãã‚Šã‹ãˆãŒä¸Šæ‰‹ã€‚å‡ºã‚‹ã¨ãã¯å‡ºã¦ã€å¼•ãã¨ãã¯å¼•ã‘ã‚‹ã‚¹ãƒãƒ¼ãƒˆã•ã€‚ã‚¤ãƒ™ãƒ³ãƒˆã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯è£æ–¹ã§ã‚‚ä¸»å½¹ç´šã®ã¯ãŸã‚‰ãã€‚ãµã ã‚“ã¯ãŠã ã‚„ã‹ã€ä»²é–“å†…ã§ã¯ã‚ˆãç¬‘ã†ã€‚è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’ãŸã„ã›ã¤ã«ã—ãªãŒã‚‰ã€é–¢ä¿‚ã‚’å°‘ã—ãšã¤åºƒã’ã‚ˆã†ã€‚ãŸã¾ã«å°ã•ãªå†’é™ºã‚’è¨­è¨ˆã™ã‚‹ã¨ã€ã†ã‚Œã—ã„å¶ç„¶ãŒãµãˆã¾ã™ã€‚",
  5: "ã»ã©ã‚ˆã„ç¤¾äº¤æ¸©åº¦ã€‚äººã¨è©±ã™ã®ã‚‚ã²ã¨ã‚Šæ™‚é–“ã‚‚ã€ã©ã¡ã‚‰ã‚‚æ¥½ã—ã‚ã‚‹ãƒãƒ©ãƒ³ã‚µãƒ¼ã€‚å ´ã®ç©ºæ°—ã‚’èª­ã¿ã€ç¬‘ã„ã®ã‚¹ã‚¤ãƒƒãƒã‚‚æŒã£ã¦ã„ã¾ã™ã€‚å¥½å¥‡å¿ƒãŒå‹•ãã»ã†ã¸ä¸€æ­©ãšã¤ã€‚äºˆå®šã«å°‘ã—ä½™è£•ã‚’ã¤ãã‚‹ã¨ã€äº¤æµã‚‚é›†ä¸­ã‚‚é•·ã‚‚ã¡ã—ã¾ã™ã€‚ã¨ãã«ä¸»å½¹ã€ã¨ãã«ç›¸æ£’ã€‚ã©ã¡ã‚‰ã®ã‚ãªãŸã‚‚ã€ã¿ã‚“ãªã«æ„›ã•ã‚Œã¾ã™ã€‚",
  6: "å‰ã‚€ãã‚³ãƒŸãƒ¥åŠ›ã€‚åˆå¯¾é¢ã§ã‚‚ç¬‘é¡”ã§è©±ã‚’ã¯ã˜ã‚ã‚‰ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã€‚ãƒãƒªã ã‘ã˜ã‚ƒãªãã€ç›¸æ‰‹ã¸ã®æ°—ã¥ã‹ã„ã‚‚ã§ãã‚‹ã®ãŒã¤ã‚ˆã¿ã€‚äºˆå®šã‚’ã¤ã‚ã™ããšã€ä¼‘ã‚€æ™‚é–“ã‚‚å…¥ã‚Œã‚‹ã¨å®‰å®šã—ã¾ã™ã€‚ã‚ãªãŸã®ä¸€è¨€ã¯ä»Šæ—¥ã®ã ã‚Œã‹ã®å‹‡æ°—ã€‚è‡ªç„¶ä½“ã®æ˜ã‚‹ã•ã‚’ãŸã„ã›ã¤ã«ã€‚ãã®ç¬‘é¡”ã¯å‘¨ã‚Šã¸ã™ã‚‹ã£ã¨åºƒãŒã‚Šã¾ã™ã€‚",
  7: "ãƒ ãƒ¼ãƒ‰ã¥ãã‚ŠãŒå¾—æ„ã€‚æ²ˆé»™ã‚‚ç¬‘ã„ã‚‚ã€ã‚„ã‚ã‚‰ã‹ãã¤ãªã’ã‚‰ã‚Œã‚‹äººã€‚è¼ªã‚’åºƒã’ã¤ã¤ã€ä¸€äººã²ã¨ã‚Šã®æ°—æŒã¡ã‚‚è¦‹ã‚‰ã‚Œã¾ã™ã€‚ä¼‘ã‚€æ™‚ã¯ã—ã£ã‹ã‚Šä¼‘ã¿ã€èµ°ã‚‹æ™‚ã¯è»½ã‚„ã‹ã«ã€‚ç››ã‚Šä¸Šã’ã‚‚èãå½¹ã‚‚ã§ãã‚‹ã®ãŒå¼·ã¿ã€‚ã¿ã‚“ãªã®è¼ãã‚’å¼•ãå‡ºã™ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹åŠ›ã§ã€å‘¨å›²ã‚’ã‚ã£ãŸã‹ãã—ã¦ãã ã•ã„ã­ã€‚",
  8: "ã‚¤ãƒ™ãƒ³ãƒˆã«å¼·ã„ã‚¨ãƒ³ã‚¸ãƒ³ã‚¿ã‚¤ãƒ—ã€‚ä¼ç”»ã®åˆé€Ÿã¨å·»ãã“ã¿åŠ›ãŒå…‰ã‚Šã¾ã™ã€‚æ¥½ã—ã•ã®ä¸­ã§ã‚‚ã€ã ã‚Œã‚‚ç½®ã„ã¦ã„ã‹ãªã„æ°—ã¥ã‹ã„ãŒã‚ã‚‹ã¨æœ€å¼·ã€‚å£°ã®å¤§ãã•ã‚ˆã‚Šã€å®‰å¿ƒã®ã¤ãã‚Šæ–¹ãŒã‚ãªãŸã®çœŸä¾¡ã§ã™ã€‚ä¼‘ã‚€äºˆå®šã‚‚ã„ã£ã—ã‚‡ã«è¨­è¨ˆã—ã¦ã€æ¥½ã—ã•ã‚’é•·ã‚‚ã¡ã•ã›ã‚ˆã†ã€‚è‡ªåˆ†ã«ã‚‚ã‚„ã•ã—ãã€ã¿ã‚“ãªã«å¤ªé™½ã€‚",
  9: "ãƒãƒ¼ãƒ ã®ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚ã‚ãªãŸãŒã„ã‚‹ã¨ç©ºæ°—ãŒãƒ‘ãƒƒã¨æ˜ã‚‹ããªã‚Šã¾ã™ã€‚äººã¨äººã‚’ã¤ãªãã€å›°ã£ã¦ã„ã‚‹å­ã‚‚è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã€‚è¡Œå‹•ã¨ç¬‘é¡”ã§å‰ã‚€ãã®æ³¢ã‚’ç”Ÿã‚€åŠ›ã¯å®ã‚‚ã®ã€‚é™ã‹ãªæ™‚é–“ã‚’å°‘ã—æŒã¤ã¨ã€ã•ã‚‰ã«ãƒ‘ãƒ¯ãƒ¼ãŒæ¾„ã¿ã¾ã™ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã¯åˆ†ã‘åˆã†ã»ã©å¼·ããªã‚‹ã€‚ãã®æ°—é…ã‚ŠãŒå¤§ããªä¿¡é ¼ã‚’ã¤ãã‚Šã¾ã™ã€‚",
  10:"è¶…ãƒã‚¤ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚§ã‚¹ç¥ã‚¿ã‚¤ãƒ—ã€‚å‘¨å›²ã‚’ä¸€ç¬ã§ãŠã¾ã¤ã‚Šã«å¤‰ãˆã‚‹æ¨é€²åŠ›ã€‚å®‰å…¨ã¨å¤šæ§˜æ€§ã¸ã®é…æ…®ãŒããªã‚ã‚‹ã¨ç„¡æ•µã§ã™ã€‚ã¨ãã©ãé™ã‹ãªè£œçµ¦ã‚¿ã‚¤ãƒ ã‚’è¨­è¨ˆã—ã¦ã€ç‡ƒæ–™ã‚’ãŸã‚ã‚ˆã†ã€‚èµ°ã‚‹ã ã‘ã§ãªãã€æ­¢ã¾ã‚‹å‹‡æ°—ã‚‚ãƒªãƒ¼ãƒ€ãƒ¼ã®åŠ›ã€‚ä»Šæ—¥ã®ç››ã‚Šä¸ŠãŒã‚Šã‚‚ã€æ˜æ—¥ã®ã‚„ã•ã—ã•ã‚‚ã€ã‚ãªãŸãªã‚‰ä¸¡æ–¹ã¤ãã‚Œã¾ã™ã€‚"
};

/* 5æ®µéšã®é¸æŠè‚¢ï¼ˆ0ã€œ4ï¼‰ */
const CHOICES = [
  {label:"ãœã‚“ãœã‚“", emoji:"ğŸŒ™", value:0},
  {label:"ã‚ã¾ã‚Š",   emoji:"ğŸŒŠ", value:1},
  {label:"ã©ã¡ã‚‰ã¨ã‚‚", emoji:"ğŸ€", value:2},
  {label:"ã‘ã£ã“ã†", emoji:"â˜€ï¸", value:3},
  {label:"ã¨ã¦ã‚‚",   emoji:"ğŸ‰", value:4},
];

/* ---------- çŠ¶æ…‹ ---------- */
let current = 0;
let transitioning = false;
const answers = Array(QUESTIONS.length).fill(null);

/* ---------- ä¾¿åˆ©é–¢æ•° ---------- */
const $ = sel => document.querySelector(sel);
const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

function show(id){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  $(id).classList.add("active");
  window.scrollTo({top:0, behavior:"smooth"});
}

function updateProgress(){
  const answered = answers.filter(a=>a!==null).length;
  const pct = Math.round(100 * answered / QUESTIONS.length);
  $("#bar").style.width = pct + "%";
  $("#qnum").textContent = `Q${current+1}/${QUESTIONS.length}`;
  // ãƒãƒ¼ãƒˆï¼ˆè³ªå•æ•°ã¶ã‚“ï¼‰
  const h = $("#hearts"); h.innerHTML = "";
  for(let i=0;i<QUESTIONS.length;i++){
    const s = el("span"); s.textContent = i < answered ? "ğŸ’–" : "ğŸ¤"; h.appendChild(s);
  }
}

function renderQuestion(){
  const q = QUESTIONS[current];
  $("#qtxt").textContent = q.text;
  $("#assist").textContent = "ã‚¿ãƒƒãƒ—ã™ã‚‹ã¨æ¬¡ã®è³ªå•ã¸";
  const form = $("#form"); form.innerHTML = "";
  CHOICES.forEach((c,idx)=>{
    const id = `q${current}c${idx}`;
    const input = el("input", {type:"radio", name:"q", id, value:String(c.value)});
    const label = el("label", {className:"opt", htmlFor:id});
    label.innerHTML = `<div class="emo">${c.emoji}</div><div class="lbl">${c.label}</div>`;
    const wrap = el("div", {}); wrap.appendChild(input); wrap.appendChild(label); form.appendChild(wrap);

    const choose = ()=>{
      if(transitioning) return;
      transitioning = true;
      answers[current] = Number(c.value);
      label.classList.add("selected");
      // è»½ãå¾…ã£ã¦ã‹ã‚‰é·ç§»ï¼ˆé¸æŠãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼‰
      setTimeout(()=>{
        if(current < QUESTIONS.length - 1){
          current++; renderQuestion(); transitioning = false;
        }else{
          renderResult(); show("#screen-result"); transitioning = false;
        }
      }, 160);
    };
    label.addEventListener("click", choose);
    input.addEventListener("change", choose); // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾å¿œ
  });

  // æ—¢ã«é¸ã‚“ã§ã„ãŸã‚‰è¡¨ç¤ºåæ˜ ï¼ˆæˆ»ã‚‹UIã¯ç„¡ã„ãŒå…±æœ‰è¡¨ç¤ºæ™‚ãªã©ï¼‰
  if(answers[current] !== null){
    const idx = CHOICES.findIndex(c=>c.value===answers[current]);
    const lab = form.querySelectorAll(".opt")[idx];
    if(lab) lab.classList.add("selected");
  }

  updateProgress();
}

function computeLevel(){
  // 1) å„è¨­å•ã‚’ -2..+2 ã«æ­£è¦åŒ–ï¼ˆreverseã¯åè»¢ï¼‰
  let oriented = [];
  for (let i = 0; i < QUESTIONS.length; i++) {
    const raw = (answers[i] ?? 2);               // æœªå›ç­”ã¯ä¸­ç«‹æ‰±ã„
    const norm = QUESTIONS[i].reverse ? (4 - raw) : raw; // 0..4ï¼ˆé™½å´ãŒå¤§ãã„ï¼‰
    let v = norm - 2;                            // -2..+2 ã«å¤‰æ›ï¼ˆ0ãŒä¸­ç«‹ï¼‰

    // 2) æ¥µç«¯å›ç­”ãƒœãƒ¼ãƒŠã‚¹ï¼ˆç«¯ã«æŒ¯ã‚Šåˆ‡ã£ãŸã‚‰å°‘ã—åŠ ç‚¹ï¼‰
    if (Math.abs(v) === 2) {
      v += (v > 0 ? 1 : -1) * SCORING.EXTREME_BONUS;
    }
    oriented.push(v);
  }

  // 3) -1..+1 ã«æ­£è¦åŒ–ï¼ˆãƒœãƒ¼ãƒŠã‚¹ã§1ã‚’è¶…ãˆã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§ã‚¯ãƒªãƒƒãƒ—ï¼‰
  const xRaw = oriented.reduce((a,b)=>a+b,0) / (2 * QUESTIONS.length);
  const x = Math.max(-1, Math.min(1, xRaw));

  // 4) éç·šå½¢å¤‰æ›ï¼ˆæŒ‡æ•° < 1 ã§ä¸­å¿ƒã‚’å¤–å´ã¸å¼•ãä¼¸ã°ã™ï¼‰
  const y = Math.sign(x) * Math.pow(Math.abs(x), SCORING.GAMMA); // -1..+1

  // 5) Uå­—ã‚«ãƒ¼ãƒ–ã®ã—ãã„å€¤ã§ãƒ¬ãƒ™ãƒ«ã«å‰²ã‚Šå½“ã¦
  let level = 10;
  for (let i = 1; i < SCORING.CUTS.length; i++) {
    if (y <= SCORING.CUTS[i]) { level = i; break; }
  }

  // è¿”ã‚Šå€¤ã¯äº’æ›ã®ãŸã‚ã«æ®‹ã—ã¦ã„ã¾ã™ï¼ˆä»–ã§ã¯ level ã ã‘ä½¿ã£ã¦ã„ã¾ã™ï¼‰
  return {
    sum: oriented.reduce((a,b)=>a+b,0), // å‚è€ƒç”¨ï¼ˆå˜ä½ã¯ -2ã€œ+2 ãƒ™ãƒ¼ã‚¹ï¼‰
    max: 2 * QUESTIONS.length,          // å‚è€ƒç”¨
    level
  };
}


function characterSVG(level){
  const hues = [205, 210, 190, 160, 140, 35, 20, 10, 350, 330];
  const hue = hues[Math.max(0, Math.min(9, level-1))];
  const base = `
  <svg width="200" height="200" viewBox="0 0 200 200" role="img" aria-label="ãƒ¬ãƒ™ãƒ«${level}ã®ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼">
    <defs>
      <radialGradient id="b${level}" cx="50%" cy="45%" r="60%">
        <stop offset="0%" stop-color="hsl(${hue},100%,98%)"/>
        <stop offset="100%" stop-color="hsl(${hue},85%,85%)"/>
      </radialGradient>
      <filter id="s${level}" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="rgba(0,0,0,.15)"/>
      </filter>
    </defs>
    <g filter="url(#s${level})">
      <circle cx="100" cy="110" r="70" fill="url(#b${level})" stroke="hsl(${hue},70%,70%)" stroke-width="3"/>
      <circle cx="75" cy="100" r="7" fill="#333"/>
      <circle cx="125" cy="100" r="7" fill="#333"/>
      <path d="M75 128 Q100 142 125 128" fill="none" stroke="#333" stroke-width="5" stroke-linecap="round"/>
      <circle cx="62" cy="112" r="8" fill="rgba(255,105,180,.35)"/>
      <circle cx="138" cy="112" r="8" fill="rgba(255,105,180,.35)"/>
    </g>
    ${accessory(level)}
  </svg>`;
  return base;

  function accessory(lv){
    switch(lv){
      case 1: return book(120,155);
      case 2: return star(50,40);
      case 3: return headphones(100,58);
      case 4: return bow(100,40);
      case 5: return clover(155,70);
      case 6: return balloon(165,40);
      case 7: return sparkle(40,155);
      case 8: return partyHat(100,28);
      case 9: return crown(100,32);
      case 10:return megaphone(162,120);
      default:return "";
    }
  }
  function book(x,y){return `<g aria-label="æœ¬"><rect x="${x-40}" y="${y-22}" rx="6" ry="6" width="80" height="44" fill="#FFF" stroke="#A6C5FF"/>
            <line x1="${x-2}" y1="${y-22}" x2="${x-2}" y2="${y+22}" stroke="#A6C5FF" stroke-width="2"/></g>`;}
  function star(x,y){return `<g aria-label="æ˜Ÿ" transform="translate(${x},${y})">
    <polygon points="0,-18 6,-4 20,-4 9,4 13,18 0,9 -13,18 -9,4 -20,-4 -6,-4" fill="#FFE58F"/></g>`;}
  function headphones(x,y){return `<g aria-label="ãƒ˜ãƒƒãƒ‰ãƒ›ãƒ³" transform="translate(${x},${y})">
    <path d="M-40,20 a40,40 0 0 1 80,0" fill="none" stroke="#333" stroke-width="6"/>
    <rect x="-52" y="18" width="18" height="24" rx="6" fill="#444"/>
    <rect x="34" y="18" width="18" height="24" rx="6" fill="#444"/></g>`;}
  function bow(x,y){return `<g aria-label="ãƒªãƒœãƒ³" transform="translate(${x},${y})">
    <circle r="5" fill="#FF7BAC"/><path d="M-5,0 C-20,-10 -28,-4 -30,8 C-20,0 -14,10 -5,5Z" fill="#FFA6C8"/>
    <path d="M5,0 C20,-10 28,-4 30,8 C20,0 14,10 5,5Z" fill="#FFA6C8"/></g>`;}
  function clover(x,y){return `<g aria-label="ã‚¯ãƒ­ãƒ¼ãƒãƒ¼" transform="translate(${x},${y})">
    <circle cx="-6" cy="-6" r="8" fill="#B9E8A0"/><circle cx="6" cy="-6" r="8" fill="#B9E8A0"/>
    <circle cx="-6" cy="6" r="8" fill="#B9E8A0"/><circle cx="6" cy="6" r="8" fill="#B9E8A0"/>
    <path d="M0,12 L0,24" stroke="#8BCB73" stroke-width="3"/></g>`;}
  function balloon(x,y){return `<g aria-label="é¢¨èˆ¹" transform="translate(${x},${y})">
    <ellipse rx="12" ry="16" fill="#FFD1DC"/><path d="M0,16 L0,36" stroke="#EAA" stroke-width="2"/></g>`;}
  function sparkle(x,y){return `<g aria-label="ãã‚‰ã‚ã" transform="translate(${x},${y})">
    <path d="M0,-14 L3,0 L0,14 L-3,0 Z" fill="#FFDDEE"/><circle r="3" fill="#FFC1D7"/></g>`;}
  function partyHat(x,y){return `<g aria-label="ãƒ‘ãƒ¼ãƒ†ã‚£ãƒãƒƒãƒˆ" transform="translate(${x},${y})">
    <polygon points="0,-16 12,12 -12,12" fill="#FFEA94" stroke="#FFC94A"/>
    <circle cx="0" cy="-18" r="4" fill="#FF9DC4"/></g>`;}
  function crown(x,y){return `<g aria-label="ã‚¯ãƒ©ã‚¦ãƒ³" transform="translate(${x},${y})">
    <path d="M-26,10 L-24,-8 L0,6 L24,-8 L26,10 Z" fill="#FFE085" stroke="#E3B200"/></g>`;}
  function megaphone(x,y){return `<g aria-label="ãƒ¡ã‚¬ãƒ›ãƒ³" transform="translate(${x},${y})">
    <path d="M-22,-6 L8,-16 L8,16 L-22,6 Z" fill="#FFD2E1" stroke="#FF8BB0"/>
    <rect x="-30" y="-6" width="8" height="12" fill="#FF8BB0"/></g>`;}
}

function renderResult(){
  const {level} = computeLevel();
  const pct = Math.round(100 * (level-1) / 9); // 0ã€œ100
  $("#meter").style.setProperty("--pct", pct);
  $("#levelVal").textContent = `Lv.${level}`;
  $("#title20").textContent = TITLES[level-1];
  $("#comment").textContent = COMMENTS[level];
  $("#yang").textContent = level;
  $("#yin").textContent = 11 - level;
  $("#character").innerHTML = characterSVG(level);

  // å›ç­”ãƒªã‚¹ãƒˆ
  const ol = $("#answerList"); ol.innerHTML = "";
  QUESTIONS.forEach((q,i)=>{
    const li = el("li");
    const a = answers[i];
    const label = (a===null) ? "æœªå›ç­”" : CHOICES[a].label;
    li.textContent = `${i+1}. ${q.text} â€¦ ã€Œ${label}ã€`;
    ol.appendChild(li);
  });

  // å…±æœ‰ç”¨
  const url = new URL(location.href);
  url.searchParams.set("lv", level);
  history.replaceState(null, "", url.toString());
}

/* ---------- ã‚¤ãƒ™ãƒ³ãƒˆ ---------- */
$("#btnStart").addEventListener("click", ()=>{
  // åˆæœŸåŒ–ã—ã¦é–‹å§‹
  for(let i=0;i<answers.length;i++) answers[i]=null;
  current = 0; transitioning = false;
  show("#screen-quiz"); renderQuestion();
});
$("#btnAbout").addEventListener("click", ()=>{
  alert("ã“ã®è¨ºæ–­ã¯ã‚¨ãƒ³ã‚¿ãƒ¡ç›®çš„ã§ã™ã€‚çµæœã§äººã‚’æ±ºã‚ã¤ã‘ãªã„ã‚„ã•ã—ã•ã‚’ã€‚ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼æƒ…å ±ã¯ä¿å­˜ã—ã¾ã›ã‚“ã€‚");
});

$("#btnRetry").addEventListener("click", ()=>{
  for(let i=0;i<answers.length;i++) answers[i]=null;
  current=0; transitioning=false;
  show("#screen-quiz"); renderQuestion();
});

$("#btnShare").addEventListener("click", async ()=>{
  const {level} = computeLevel();
  const text = `Kawaii Meterã§è¨ºæ–­ï¼\né™½ã‚­ãƒ£åº¦: ${level}/10\nã€Œ${TITLES[level-1]}ã€`;
  const url = location.href;
  try{
    if(navigator.share){ await navigator.share({title:"é™½ã‚­ãƒ£ãƒ»é™°ã‚­ãƒ£è¨ºæ–­", text, url}); }
    else{ await navigator.clipboard.writeText(text + "\n" + url); alert("å…±æœ‰APIéå¯¾å¿œã®ãŸã‚ã€çµæœãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); }
  }catch(e){ /* ã‚­ãƒ£ãƒ³ã‚»ãƒ«ç­‰ */ }
});
$("#btnCopy").addEventListener("click", async ()=>{
  try{ await navigator.clipboard.writeText(location.href); alert("çµæœãƒªãƒ³ã‚¯ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼"); }
  catch(e){ prompt("ã‚³ãƒ”ãƒ¼ã§ããªã„å ´åˆã¯æ‰‹å‹•ã§é¸ã‚“ã§ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„", location.href); }
});

/* ---------- å…±æœ‰ãƒªãƒ³ã‚¯ã§ç›´æ¥ãƒ¬ãƒ™ãƒ«è¡¨ç¤º ---------- */
(function showLevelByUrl(){
  const lv = Number(new URL(location.href).searchParams.get("lv"));
  if(lv>=1 && lv<=10){
    answers.fill(2); // è¡¨ç¤ºç”¨
    show("#screen-result");
    $("#meter").style.setProperty("--pct", Math.round(100*(lv-1)/9));
    $("#levelVal").textContent = `Lv.${lv}`;
    $("#title20").textContent = TITLES[lv-1];
    $("#comment").textContent = COMMENTS[lv];
    $("#yang").textContent = lv;
    $("#yin").textContent = 11 - lv;
    $("#character").innerHTML = characterSVG(lv);
    $("#answerList").innerHTML = "<li>å…±æœ‰ãƒªãƒ³ã‚¯ã‹ã‚‰ã®è¡¨ç¤ºã§ã™ã€‚è¨ºæ–­ã‚’ã‚„ã‚Šç›´ã™ã¨å›ç­”ä¸€è¦§ãŒå‡ºã¾ã™ã€‚</li>";
  }
})();
</script>
</body>
</html>

<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#FAFBFF" />
  <title>陽キャ・陰キャ診断｜Kawaii Meter</title>
  <style>
    :root{
      /* グレイッシュ・パステル（大人め） */
      --bg:#FAFBFF;
      --bg-grad:linear-gradient(180deg,#FAFBFF 0%, #F7F5FA 100%);
      --card:#FFFFFF;
      --ink:#2B2F3A;
      --muted:#6B7280;
      --line:#E5E7EB;

      --accent:#9EC5FE;   /* ペールブルー */
      --accent-2:#F7B8D9; /* ソフトローズ */
      --accent-3:#B7EBD3; /* セルリアンミント */

      --shadow: 0 2px 10px rgba(17,24,39,.06), 0 1px 1px rgba(17,24,39,.04);
      --radius:12px;
      --radius-lg:16px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Hiragino Sans", "Noto Sans JP", "Yu Gothic", Meiryo, system-ui, sans-serif;
      background: var(--bg-grad);
      color:var(--ink);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.65;
    }
    .wrap{max-width:840px;margin:0 auto;padding:18px 16px 28px}

    header{display:flex;align-items:center;gap:10px;padding:10px 6px 14px;}
    .brand{
      display:flex;align-items:center;gap:10px;font-weight:800;font-size:20px;letter-spacing:.01em;
    }
    .brand-badge{
      width:40px;height:40px;border-radius:10px;background:#fff;border:1px solid var(--line);
      display:grid;place-items:center;box-shadow:var(--shadow)
    }
    .brand-badge span{font-size:14px;color:#334155;font-weight:800;letter-spacing:.08em}
    .sub{color:var(--muted);font-size:13px;margin-top:-4px}

    .card{
      background:var(--card);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow);
      border:1px solid var(--line);
      padding:18px;
    }
    .screen{display:none}
    .screen.active{display:block}

    /* START */
    .hero{display:grid;gap:12px;justify-items:center;text-align:center;padding:6px 8px 14px;}
    .hero h1{margin:8px 0 0;font-size:22px;letter-spacing:.01em}
    .hero p{margin:2px 0;color:var(--muted)}
    .start-art{
      width:200px;height:200px;border-radius:50%;
      background: radial-gradient(60% 60% at 50% 45%, #FFFFFF 0%, #F0F4FF 65%, #EDE7F6 100%);
      box-shadow: var(--shadow);
      position:relative; overflow:hidden;
    }
    .float{ display:none !important; } /* 子どもっぽい装飾は非表示 */

    .actions{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:8px}
    .btn{
      appearance:none;border:1px solid var(--line);
      border-radius:12px;padding:12px 16px;
      font-weight:700;letter-spacing:.02em;cursor:pointer;
      background:linear-gradient(180deg, #A8C5FF, var(--accent));
      color:#fff;transition:.15s transform,.2s box-shadow,.2s background;
      box-shadow: 0 1px 2px rgba(17,24,39,.06);
      font-size:16px;
    }
    .btn:hover{ transform:translateY(-1px) }
    .btn:active{ transform:translateY(0) }
    .btn.ghost{
      background:#fff;color:var(--ink);border:1px solid var(--line)
    }

    /* QUIZ */
    .progress{
      height:10px;background:#F4F6FA;border:1px solid var(--line);
      border-radius:999px;position:relative;margin:6px 2px 18px;overflow:hidden;
    }
    .bar{height:100%;width:0;background:linear-gradient(90deg,#BFD6FF,#F8C9DF,#CDEEDC);transition:width .35s ease;border-radius:999px}
    .progress .hearts{position:absolute;inset:0;display:flex;gap:6px;justify-content:center;align-items:center;opacity:.7}
    .progress .hearts span{font-size:12px;line-height:10px}
    .qhead{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:4px 0 10px}
    .qnum{font-weight:800;background:#F4F6FF;color:#1F2937;border:1px solid var(--line);border-radius:999px;padding:4px 10px}
    .qtxt{font-size:18px;font-weight:700}
    .options{display:grid;grid-template-columns:1fr;gap:10px;margin:12px 0}
    @media(min-width:560px){.options{grid-template-columns:repeat(5,1fr)}}
    .opt{
      border:1px solid var(--line);border-radius:12px;padding:14px 10px;text-align:center;cursor:pointer;user-select:none;
      display:grid;gap:6px;align-content:center;min-height:68px;background:#fff;transition:border-color .12s, box-shadow .12s, transform .08s
    }
    .opt:active{transform:scale(.99)}
    .opt .emo{display:none} /* 絵文字は使わない */
    .opt .lbl{font-size:13px;color:#374151}
    input[type=radio]{position:absolute;opacity:0;pointer-events:none}
    .selected{border-color: var(--accent); box-shadow:0 0 0 3px rgba(158,197,254,.35)}

    /* RESULT */
    .result-top{display:grid;gap:14px;justify-items:center;text-align:center}
    .meter{
      width:180px;height:180px;border-radius:50%;
      background:conic-gradient(#8FB6FF calc(var(--pct)*1%), #EEF2FF 0);
      position:relative;display:grid;place-items:center;box-shadow:var(--shadow)
    }
    .meter:after{
      content:"";position:absolute;inset:12px;border-radius:50%;background:#fff;
      box-shadow:inset 0 0 0 6px #F3F5FE;
    }
    .meter .val{position:relative;font-weight:800;font-size:28px;z-index:1}
    .title{font-weight:800;font-size:17px;background:#F4F6FF;padding:6px 10px;border-radius:10px;display:inline-block}
    .two-cols{display:grid;gap:16px;margin-top:12px}
    @media(min-width:720px){.two-cols{grid-template-columns: 1.1fr .9fr;align-items:start}}
    .speech{
      background:linear-gradient(#FFFFFF,#FAFAFE);
      border:1px solid var(--line);border-radius:14px;padding:14px 14px 18px
    }
    .char-card{
      background:#fff;border-radius:14px;padding:14px;box-shadow:var(--shadow);display:grid;gap:8px;justify-items:center;border:1px solid var(--line)
    }
    .share{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:10px}
    .muted{color:var(--muted);font-size:12px}

    .answers{margin-top:14px;font-size:14px;color:#444}
    .answers details{background:#FAFBFF;border-radius:12px;padding:10px;border:1px solid var(--line)}
    .answers summary{cursor:pointer;font-weight:700}
    .answers ol{margin:8px 0 0 18px}
    .answers li{margin:4px 0}

    @media(prefers-reduced-motion: reduce){
      .btn, .bar{transition:none}
    }
    footer{margin-top:18px;color:var(--muted);font-size:12px;text-align:center}
    a{color:#1D6AE5;text-decoration:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand-badge" aria-hidden="true"><span>KM</span></div>
      <div>
        <div class="brand">Kawaii Meter｜陽キャ・陰キャ診断</div>
        <div class="sub">気軽に遊べるライト診断（全12問・所要1分）</div>
      </div>
    </header>

    <!-- START -->
    <section id="screen-start" class="screen active">
      <div class="card hero">
        <div class="start-art" aria-hidden="true"></div>
        <h1>あなたの「陽キャ・陰キャ度」を<br/>さくっと診断</h1>
        <p>※ エンタメ用。結果で人を決めつけない優しさを。</p>
        <div class="actions">
          <button class="btn" id="btnStart">スタート</button>
          <button class="btn ghost" id="btnAbout">診断について</button>
        </div>
      </div>
    </section>

    <!-- QUIZ -->
    <section id="screen-quiz" class="screen">
      <div class="card">
        <div class="progress" aria-hidden="true">
          <div class="bar" id="bar" style="width:0%"></div>
          <div class="hearts" id="hearts" aria-hidden="true"></div>
        </div>
        <div class="qhead">
          <div class="qnum" id="qnum">Q1/12</div>
          <div class="muted" id="assist" aria-live="polite"></div>
        </div>
        <div class="qtxt" id="qtxt">質問テキスト</div>
        <form id="form" class="options" aria-describedby="assist"><!-- options injected --></form>
        <!-- ボタン無し：タップ即・次へ -->
      </div>
    </section>

    <!-- RESULT -->
    <section id="screen-result" class="screen">
      <div class="card">
        <div class="result-top">
          <div class="meter" id="meter" style="--pct:50"><div class="val" id="levelVal">Lv.5</div></div>
          <div>
            <div class="title" id="title20">タイトル</div>
            <div class="muted" id="subline">陽キャ度 <b id="yang">5</b>／10・陰キャ度 <b id="yin">6</b>／10</div>
          </div>
        </div>

        <div class="two-cols">
          <div class="speech" id="comment"><!-- コメント --></div>
          <div class="char-card">
            <div id="character" aria-label="あなたのキャラクター"></div>
            <div class="share">
              <button class="btn" id="btnShare">結果をシェア</button>
              <button class="btn ghost" id="btnCopy">リンクをコピー</button>
              <button class="btn" id="btnRetry">もう一回やる</button>
            </div>
          </div>
        </div>

        <div class="answers">
          <details>
            <summary>あなたの回答（タップで開く）</summary>
            <ol id="answerList"></ol>
          </details>
        </div>
      </div>
    </section>

    <footer><p>© 2025 Kawaii Meter – この診断は遊び目的です。個人情報は収集しません。</p></footer>
  </div>

<script>
"use strict";

/* ====== スコア調整（マイルド寄り・端は希少） ====== */
const SCORING = {
  GAMMA: 0.95,         // 0.90〜1.00：小さいほど端が出やすい（今回は控えめ）
  EXTREME_BONUS: 0.20, // 0.0〜0.4：最端の回答に小さく加点
  CUTS: [-1, -0.8, -0.6, -0.4, -0.2, 0, 0.2, 0.4, 0.6, 0.8, 1] // 等間隔
};

/* ---------- データ定義（12問・タップ即進行） ---------- */
const QUESTIONS = [
  { text:"空き時間は人が集まる場所に自然といる", reverse:false },
  { text:"初対面と話すのはワクワクする", reverse:false },
  { text:"SNSで自分の近況をよく発信する", reverse:false },
  { text:"イベントは全力で楽しむ", reverse:false },
  { text:"みんなの前で発言するのはそんなに苦じゃない", reverse:false },
  { text:"ひとり時間がいちばん落ち着く", reverse:true  },
  { text:"音が大きい場所は少しつかれやすい", reverse:true  },
  { text:"予定がないとちょっとそわそわする", reverse:false },
  { text:"友だちの友だちともすぐ仲よくなる", reverse:false },
  { text:"グループの中心より裏方が落ち着く", reverse:true  },
  { text:"初めての場でも自分からあいさつできる", reverse:false },
  { text:"長いひとり時間でも案外たいくつしない", reverse:true  },
];

/* タイトル：10文字程度、かな/カナ/漢字バランス */
const TITLES = [
  "しずかめ内省ガイド",     // Lv1
  "ひそやか参謀モード",     // Lv2
  "おちつきミドルタイプ",   // Lv3
  "静と動のバランサー",     // Lv4
  "ちょうどいい社交派",     // Lv5
  "にこやかトーク派",       // Lv6
  "ムードづくり名人級",     // Lv7
  "フェス気質の盛上げ手",   // Lv8
  "笑顔発電トップ層",       // Lv9
  "祝祭センターリーダー",   // Lv10
];

/* コメント：漢字率ひかえめ・やわらか口調（約200字） */
const COMMENTS = {
  1: "しずかにようすを見るタイプ。にぎやかな場所より、ひとり時間でエネルギーをためるほうが合います。少人数だとことばがやさしく届くので、無理に主役にならなくて大丈夫。気が合う人にだけ、扉をちょっとひらく。ていねいな観察とまじめさは、チームの安心をつくる力です。静けさはあなたのつよみ。",
  2: "控えめなコミュ力で場をささえる参謀タイプ。目立つより、準備や聞き役がうまい人。小さな輪からゆっくり広げれば、むりなく友だちがふえます。週に一回だけ、あいさつや一言のチャレンジを決めると自信が育ちます。小声でもちゃんと届く。あなたの言葉は空気をやわらかくします。",
  3: "落ち着いたミドル。よく見て、考えてから話すから、ことばがやさしく正確。まとめ役や仕上げで光ります。つかれた日はやすみ、元気な日は小さな挑戦。ゆるいリズムが魅力を高めます。相手のよさを引き出す質問が得意。ときどき最初のひと声を。あなたの一歩が場をあたためます。",
  4: "静と動のきりかえが上手。出るときは出て、引くときは引けるスマートさ。イベントやプロジェクトでは裏方でも主役級のはたらき。ふだんはおだやか、仲間内ではよく笑う。自分のペースをたいせつにしながら、関係を少しずつ広げよう。たまに小さな冒険を設計すると、うれしい偶然がふえます。",
  5: "ほどよい社交温度。人と話すのもひとり時間も、どちらも楽しめるバランサー。場の空気を読み、笑いのスイッチも持っています。好奇心が動くほうへ一歩ずつ。予定に少しよゆうをつくると、交流も集中も長もちします。ときに主役、ときに相棒。どちらのあなたも、みんなに愛されます。",
  6: "前むきコミュ力。初対面でも笑顔で話をはじめられるタイプ。ノリだけじゃなく、相手への気づかいもできるのがつよみ。予定をつめすぎず、休む時間も入れると安定します。あなたの一言は今日のだれかの勇気。自然体の明るさをたいせつに。その笑顔は周りへするっと広がります。",
  7: "ムードづくりが得意。沈黙も笑いも、やわらかくつなげられる人。輪を広げつつ、一人ひとりの気持ちも見られます。休む時はしっかり休み、走る時は軽やかに。盛り上げも聞き役もできるのが強み。みんなの輝きを引き出すプロデュース力で、周囲をあったかくしてくださいね。",
  8: "イベントに強いエンジンタイプ。企画の初速と巻きこみ力が光ります。楽しさの中でも、だれも置いていかない気づかいがあると最強。声の大きさより、安心のつくり方があなたの真価です。休む予定もいっしょに設計して、楽しさを長もちさせよう。自分にもやさしく、みんなに太陽。",
  9: "チームのムードメーカー。あなたがいると空気がパッと明るくなります。人と人をつなぎ、困っている子も見つけられる。行動と笑顔で前むきの波を生む力は宝もの。静かな時間を少し持つと、さらにパワーが澄みます。リーダーシップは分け合うほど強くなる。その気配りが大きな信頼をつくります。",
  10:"超ハイテンションのフェス神タイプ。チームを一瞬でおまつりに変える推進力。安全と多様性への配慮がそなわると無敵です。ときどき静かな補給タイムを設計して、燃料をためよう。走るだけでなく、止まる勇気もリーダーの力。今日の盛り上がりも、明日のやさしさも、あなたなら両方つくれます。"
};

/* 5段階の選択肢（0〜4） */
const CHOICES = [
  {label:"ぜんぜん", emoji:"", value:0},
  {label:"あまり",   emoji:"", value:1},
  {label:"どちらとも", emoji:"", value:2},
  {label:"けっこう", emoji:"", value:3},
  {label:"とても",   emoji:"", value:4},
];

/* ---------- 状態 ---------- */
let current = 0;
let transitioning = false;
const answers = Array(QUESTIONS.length).fill(null);

/* ---------- 便利関数 ---------- */
const $ = sel => document.querySelector(sel);
const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);

function show(id){
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  $(id).classList.add("active");
  window.scrollTo({top:0, behavior:"smooth"});
}

/* 進捗（バー＋ドット） */
function updateProgress(){
  const answered = answers.filter(a=>a!==null).length;
  const pct = Math.round(100 * answered / QUESTIONS.length);
  $("#bar").style.width = pct + "%";
  $("#qnum").textContent = `Q${current+1}/${QUESTIONS.length}`;

  const h = $("#hearts"); h.innerHTML = "";
  for(let i=0;i<QUESTIONS.length;i++){
    const s = el("span");
    s.textContent = "•";
    s.style.opacity = i < answered ? "1" : ".25";
    h.appendChild(s);
  }
}

/* 質問描画（タップ即・次へ） */
function renderQuestion(){
  const q = QUESTIONS[current];
  $("#qtxt").textContent = q.text;
  $("#assist").textContent = "タップすると次の質問へ";
  const form = $("#form"); form.innerHTML = "";
  CHOICES.forEach((c,idx)=>{
    const id = `q${current}c${idx}`;
    const input = el("input", {type:"radio", name:"q", id, value:String(c.value)});
    const label = el("label", {className:"opt", htmlFor:id});
    label.innerHTML = `<div class="emo"></div><div class="lbl">${c.label}</div>`;
    const wrap = el("div", {}); wrap.appendChild(input); wrap.appendChild(label); form.appendChild(wrap);

    const choose = ()=>{
      if(transitioning) return;
      transitioning = true;
      answers[current] = Number(c.value);
      label.classList.add("selected");
      setTimeout(()=>{
        if(current < QUESTIONS.length - 1){
          current++; renderQuestion(); transitioning = false;
        }else{
          renderResult(); show("#screen-result"); transitioning = false;
        }
      }, 160);
    };
    label.addEventListener("click", choose);
    input.addEventListener("change", choose); // キーボード対応
  });

  // 既選択の反映（共有表示時など）
  if(answers[current] !== null){
    const idx = CHOICES.findIndex(c=>c.value===answers[current]);
    const lab = form.querySelectorAll(".opt")[idx];
    if(lab) lab.classList.add("selected");
  }

  updateProgress();
}

/* マイルド分布のレベル計算 */
function computeLevel(){
  // -2..+2（reverseで反転）、端の回答には小ボーナス
  let oriented = [];
  for (let i = 0; i < QUESTIONS.length; i++) {
    const raw = (answers[i] ?? 2);
    const norm = QUESTIONS[i].reverse ? (4 - raw) : raw; // 0..4（陽側大）
    let v = norm - 2; // -2..+2
    if (Math.abs(v) === 2) v += (v > 0 ? 1 : -1) * SCORING.EXTREME_BONUS;
    oriented.push(v);
  }
  // 合算を -1..+1 に正規化
  const xRaw = oriented.reduce((a,b)=>a+b,0) / (2 * QUESTIONS.length);
  const x = Math.max(-1, Math.min(1, xRaw));
  // 少しだけ外側に引き伸ばす
  const y = Math.sign(x) * Math.pow(Math.abs(x), SCORING.GAMMA); // -1..+1
  // 10段階へ
  let level = 10;
  for (let i = 1; i < SCORING.CUTS.length; i++) {
    if (y <= SCORING.CUTS[i]) { level = i; break; }
  }
  return { sum: oriented.reduce((a,b)=>a+b,0), max: 2 * QUESTIONS.length, level };
}

/* キャラクターSVG（やさしめの色味） */
function characterSVG(level){
  const hues = [205, 210, 190, 160, 140, 35, 20, 10, 350, 330];
  const hue = hues[Math.max(0, Math.min(9, level-1))];
  return `
  <svg width="200" height="200" viewBox="0 0 200 200" role="img" aria-label="レベル${level}のキャラクター">
    <defs>
      <radialGradient id="b${level}" cx="50%" cy="45%" r="60%">
        <stop offset="0%" stop-color="hsl(${hue},100%,98%)"/>
        <stop offset="100%" stop-color="hsl(${hue},85%,86%)"/>
      </radialGradient>
      <filter id="s${level}" x="-20%" y="-20%" width="140%" height="140%">
        <feDropShadow dx="0" dy="2" stdDeviation="2" flood-color="rgba(0,0,0,.12)"/>
      </filter>
    </defs>
    <g filter="url(#s${level})">
      <circle cx="100" cy="110" r="70" fill="url(#b${level})" stroke="hsl(${hue},60%,72%)" stroke-width="2"/>
      <circle cx="75" cy="100" r="6" fill="#333"/>
      <circle cx="125" cy="100" r="6" fill="#333"/>
      <path d="M75 128 Q100 140 125 128" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round"/>
      <circle cx="62" cy="112" r="7" fill="rgba(255,105,180,.25)"/>
      <circle cx="138" cy="112" r="7" fill="rgba(255,105,180,.25)"/>
    </g>
  </svg>`;
}

/* 結果描画 */
function renderResult(){
  const {level} = computeLevel();
  const pct = Math.round(100 * (level-1) / 9); // 0〜100
  $("#meter").style.setProperty("--pct", pct);
  $("#levelVal").textContent = `Lv.${level}`;
  $("#title20").textContent = TITLES[level-1];
  $("#comment").textContent = COMMENTS[level];
  $("#yang").textContent = level;
  $("#yin").textContent = 11 - level;
  $("#character").innerHTML = characterSVG(level);

  // 回答リスト
  const ol = $("#answerList"); ol.innerHTML = "";
  QUESTIONS.forEach((q,i)=>{
    const li = el("li");
    const a = answers[i];
    const label = (a===null) ? "未回答" : CHOICES[a].label;
    li.textContent = `${i+1}. ${q.text} … 「${label}」`;
    ol.appendChild(li);
  });

  // 共有用
  const url = new URL(location.href);
  url.searchParams.set("lv", level);
  history.replaceState(null, "", url.toString());
}

/* ---------- イベント ---------- */
$("#btnStart").addEventListener("click", ()=>{
  for(let i=0;i<answers.length;i++) answers[i]=null;
  current = 0; transitioning = false;
  show("#screen-quiz"); renderQuestion();
});
$("#btnAbout").addEventListener("click", ()=>{
  alert("この診断はエンタメ目的です。結果で人を決めつけないやさしさを。プライバシー情報は保存しません。");
});
$("#btnRetry").addEventListener("click", ()=>{
  for(let i=0;i<answers.length;i++) answers[i]=null;
  current=0; transitioning=false;
  show("#screen-quiz"); renderQuestion();
});
$("#btnShare").addEventListener("click", async ()=>{
  const {level} = computeLevel();
  const text = `Kawaii Meterで診断！\\n陽キャ度: ${level}/10\\n「${TITLES[level-1]}」`;
  const url = location.href;
  try{
    if(navigator.share){ await navigator.share({title:"陽キャ・陰キャ診断", text, url}); }
    else{ await navigator.clipboard.writeText(text + "\\n" + url); alert("共有API非対応のため、結果テキストをコピーしました！"); }
  }catch(e){ /* キャンセル等 */ }
});
$("#btnCopy").addEventListener("click", async ()=>{
  try{ await navigator.clipboard.writeText(location.href); alert("結果リンクをコピーしました！"); }
  catch(e){ prompt("コピーできない場合は手動で選んでコピーしてください", location.href); }
});

/* 共有リンクで直接レベル表示 */
(function showLevelByUrl(){
  const lv = Number(new URL(location.href).searchParams.get("lv"));
  if(lv>=1 && lv<=10){
    answers.fill(2); // 表示用
    show("#screen-result");
    $("#meter").style.setProperty("--pct", Math.round(100*(lv-1)/9));
    $("#levelVal").textContent = `Lv.${lv}`;
    $("#title20").textContent = TITLES[lv-1];
    $("#comment").textContent = COMMENTS[lv];
    $("#yang").textContent = lv;
    $("#yin").textContent = 11 - lv;
    $("#character").innerHTML = characterSVG(lv);
    $("#answerList").innerHTML = "<li>共有リンクからの表示です。診断をやり直すと回答一覧が出ます。</li>";
  }
})();
</script>
</body>
</html>
